class QuantumNameTool{constructor(e){this.container=document.getElementById(e),this.selectedNames=[],this.auditLog=[],this.init()}init(){this.container.innerHTML='\n      <div class="tool-card">\n        <div class="tool-header">\n          <h2>ğŸ‘¥ Quantum Name Picker</h2>\n          <p class="tool-description">Fair and transparent name selection using quantum randomness - perfect for raffles, giveaways, and student selection</p>\n        </div>\n        \n        <div class="tool-controls">\n          <div class="control-row space-y-6 mb-6">\n            <div class="input-group full-width">\n              <label for="names-input" class="block text-sm font-bold text-gray-700 mb-1">Names List <span class="text-gray-400 font-normal">(one per line)</span></label>\n              <textarea id="names-input" rows="8" placeholder="Enter names, one per line:\nAlice Johnson\nBob Smith\nCarol Davis"\n                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-quantum-light focus:border-quantum-light outline-none transition-all shadow-sm text-gray-800 font-mono text-sm resize-y"></textarea>\n              <div class="input-stats flex justify-between mt-1 text-xs text-gray-500">\n                <span id="name-count">0 names</span> \n                <span id="duplicate-warning" class="hidden text-orange-600 font-medium">Contains duplicates</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class="control-row space-y-4 mb-6">\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">\n              <div class="input-group">\n                <label for="winners-count" class="block text-sm font-bold text-gray-700 mb-1">Number of Winners</label>\n                <input type="number" id="winners-count" value="1" min="1" max="50"\n                  class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-quantum-light focus:border-quantum-light outline-none transition-all shadow-sm text-gray-800 font-mono">\n                <span class="text-xs text-gray-500 mt-1 block">1-50 winners</span>\n              </div>\n              \n              <div class="flex flex-col gap-3 pb-1">\n                <div class="checkbox-group flex items-center gap-2">\n                  <input type="checkbox" id="assign-numbers" class="w-5 h-5 text-quantum-light rounded border-gray-300 focus:ring-quantum-light" />\n                  <label for="assign-numbers" class="font-medium text-gray-700 cursor-pointer text-sm">Assign random numbers to winners</label>\n                </div>\n                \n                <div class="checkbox-group flex items-center gap-2">\n                  <input type="checkbox" id="remove-duplicates" checked class="w-5 h-5 text-quantum-light rounded border-gray-300 focus:ring-quantum-light" />\n                  <label for="remove-duplicates" class="font-medium text-gray-700 cursor-pointer text-sm">Remove duplicate names</label>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <button id="select-winners" class="generate-btn">\n            <span class="btn-icon">ğŸ¯</span>\n            Select Winners\n          </button>\n          \n          <button id="load-example" class="secondary-btn">\n            <span class="btn-icon">ğŸ“</span>\n            Load Example Names\n          </button>\n        </div>\n        \n        <div class="tool-results">\n          <div id="name-loading" class="loading hidden">\n            <div class="spinner"></div>\n            <p>Quantum selection in progress...</p>\n          </div>\n          \n          <div id="name-error" class="error hidden">\n            <div class="error-icon">âš ï¸</div>\n            <div class="error-content">\n              <h4>Error</h4>\n              <p id="name-error-message"></p>\n            </div>\n          </div>\n          \n          <div id="name-success" class="success hidden">\n            <div class="result-header">\n              <h3>ğŸ† Selected Winners</h3>\n              <div class="result-actions">\n                <button id="copy-winners" class="copy-btn">ğŸ“‹ Copy Results</button>\n                <button id="export-winners" class="download-btn">ğŸ’¾ Export</button>\n              </div>\n            </div>\n            \n            <div class="result-metadata">\n              <span class="metadata-item">From: <strong id="total-names-display"></strong> names</span>\n              <span class="metadata-item">Selected: <strong id="winners-count-display"></strong> winners</span>\n              <span class="metadata-item">Method: <strong>Quantum Fisher-Yates</strong></span>\n              <span class="metadata-item">Time: <strong id="selection-timestamp"></strong></span>\n            </div>\n            \n            <div class="winners-list" id="winners-list">\n              \x3c!-- Winners will be populated here --\x3e\n            </div>\n            \n            <div class="audit-section">\n              <h4>ğŸ” Transparency Audit</h4>\n              <div class="audit-log" id="audit-log">\n                \x3c!-- Audit entries will be populated here --\x3e\n              </div>\n              <button id="toggle-audit" class="toggle-btn">Show Full Quantum Audit</button>\n            </div>\n          </div>\n          \n          <div class="guidance-section">\n            <h3>ğŸ’¡ Usage Guide</h3>\n            <div class="guidance-content">\n              <div class="use-case">\n                <h4>ğŸ Raffles & Giveaways</h4>\n                <p>Enter participant names to select random winners fairly and transparently</p>\n              </div>\n              <div class="use-case">\n                <h4>ğŸ“ Student Selection</h4>\n                <p>Choose students for presentations, activities, or random grouping</p>\n              </div>\n              <div class="use-case">\n                <h4>ğŸ¯ Team Assignments</h4>\n                <p>Randomly assign team leaders, rotate responsibilities, or pick volunteers</p>\n              </div>\n              <div class="fairness-note">\n                <strong>Quantum Fairness:</strong> Unlike pseudo-random selections, this tool uses genuine quantum randomness \n                to ensure each participant has an exactly equal chance of selection.\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ',this.bindEvents()}bindEvents(){const e=this.container.querySelector("#select-winners"),n=this.container.querySelector("#load-example"),t=this.container.querySelector("#copy-winners"),s=this.container.querySelector("#export-winners"),i=this.container.querySelector("#toggle-audit"),a=this.container.querySelector("#names-input"),r=this.container.querySelector("#winners-count");e.addEventListener("click",()=>this.selectWinners()),n.addEventListener("click",()=>this.loadExampleNames()),t.addEventListener("click",()=>this.copyResults()),s.addEventListener("click",()=>this.exportResults()),i.addEventListener("click",()=>this.toggleAuditDetails()),a.addEventListener("input",()=>this.updateNameStats()),r.addEventListener("input",()=>this.validateWinnersCount()),r.addEventListener("keypress",e=>{"Enter"===e.key&&this.selectWinners()}),this.updateNameStats()}updateNameStats(){const e=this.container.querySelector("#names-input"),n=this.container.querySelector("#name-count"),t=this.container.querySelector("#duplicate-warning"),s=this.container.querySelector("#remove-duplicates").checked,i=e.value.trim();if(!i)return n.textContent="0 names",void t.classList.add("hidden");const a=i.split("\n").map(e=>e.trim()).filter(e=>e),r=new Set(a);n.textContent=`${a.length} names`,a.length!==r.size?(t.classList.remove("hidden"),t.textContent=s?a.length-r.size+" duplicates (will be removed)":a.length-r.size+" duplicates found"):t.classList.add("hidden"),this.validateWinnersCount()}validateWinnersCount(){const e=this.container.querySelector("#names-input"),n=this.container.querySelector("#winners-count"),t=this.container.querySelector("#remove-duplicates").checked,s=e.value.trim();if(!s)return;const i=s.split("\n").map(e=>e.trim()).filter(e=>e),a=t?new Set(i).size:i.length,r=parseInt(n.value)||0;r>a?n.setCustomValidity(`Cannot select ${r} winners from ${a} names`):n.setCustomValidity("")}loadExampleNames(){this.container.querySelector("#names-input").value=["Alice Johnson","Bob Smith","Carol Davis","David Wilson","Eva Martinez","Frank Chen","Grace Lee","Henry Brown","Irene Taylor","Jack Anderson","Karen White","Luis Rodriguez","Maria Garcia","Nathan Jones","Olivia Thompson"].join("\n"),this.container.querySelector("#winners-count").value="3",this.updateNameStats()}async selectWinners(){const e=this.container.querySelector("#names-input"),n=parseInt(this.container.querySelector("#winners-count").value),t=this.container.querySelector("#assign-numbers").checked,s=this.container.querySelector("#remove-duplicates").checked,i=e.value.trim();if(!i)return void this.showError("Please enter at least one name");let a=i.split("\n").map(e=>e.trim()).filter(e=>e);if(s&&(a=[...new Set(a)]),0!==a.length)if(isNaN(n)||n<1||n>Math.min(50,a.length))this.showError(`Number of winners must be between 1 and ${Math.min(50,a.length)}`);else{this.showLoading();try{const e=await this.quantumFisherYatesShuffle(a);if(this.selectedNames=e.shuffled.slice(0,n),this.auditLog=e.auditLog,t){const e=await qrngService.getUint16(n);this.selectedNames=this.selectedNames.map((n,t)=>({name:n,number:e[t],originalIndex:a.indexOf(n)+1}))}else this.selectedNames=this.selectedNames.map((e,n)=>({name:e,number:null,originalIndex:a.indexOf(e)+1}));this.showResults(a.length,n),qrngService.emit("tool_usage",{tool:"name_picker",total_names:a.length,winners:n,assign_numbers:t,remove_duplicates:s})}catch(e){console.error("Name selection error:",e),this.showError(`Failed to select names: ${e.message}`)}}else this.showError("No valid names found")}async quantumFisherYatesShuffle(e){const n=[...e],t=[],s=n.length,i=await qrngService.getUint16(s-1);for(let e=s-1;e>0;e--){const a=i[s-1-e],r=a%(e+1);[n[e],n[r]]=[n[r],n[e]],t.push({step:s-e,quantumValue:a,swapIndices:[e,r],swapNames:[n[r],n[e]],remainingPool:e+1})}return{shuffled:n,auditLog:t}}showResults(e,n){this.container.querySelector("#total-names-display").textContent=e,this.container.querySelector("#winners-count-display").textContent=n,this.container.querySelector("#selection-timestamp").textContent=(new Date).toLocaleTimeString();const t=this.container.querySelector("#winners-list");t.innerHTML="",this.selectedNames.forEach((e,n)=>{const s=document.createElement("div");s.className="winner-item";const i=null!==e.number?`<span class="winner-number">#${e.number}</span>`:"";s.innerHTML=`\n        <div class="winner-rank">${n+1}</div>\n        <div class="winner-info">\n          <div class="winner-name">${this.escapeHtml(e.name)}</div>\n          <div class="winner-details">\n            Original position: #${e.originalIndex}\n            ${null!==e.number?` â€¢ Assigned number: ${e.number}`:""}\n          </div>\n        </div>\n        ${i}\n        <button class="copy-winner-btn" data-winner="${this.escapeHtml(e.name)}" title="Copy this winner">\n          ğŸ“‹\n        </button>\n      `,s.querySelector(".copy-winner-btn").addEventListener("click",n=>{this.copyWinner(e.name)}),t.appendChild(s)}),this.populateAuditLog(),this.container.querySelector("#name-success").classList.remove("hidden"),this.container.querySelector("#name-loading").classList.add("hidden"),this.container.querySelector("#name-error").classList.add("hidden"),this.container.querySelector("#select-winners").disabled=!1}escapeHtml(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}populateAuditLog(){const e=this.container.querySelector("#audit-log"),n=`Selection used ${this.auditLog.length} quantum random values to shuffle the list. `,t=`Each name had an equal ${(1/this.selectedNames.length*100).toFixed(1)}% chance of selection.`;e.innerHTML=`\n      <div class="audit-summary">\n        <p>${n}${t}</p>\n        <div class="audit-details hidden" id="audit-details">\n          <h5>Detailed Shuffle Steps:</h5>\n          ${this.auditLog.map(e=>`\n            <div class="audit-entry">\n              <strong>Step ${e.step}:</strong> \n              Quantum value ${e.quantumValue} â†’ \n              Swap position ${e.swapIndices[0]} with ${e.swapIndices[1]} \n              (${e.remainingPool} names in pool)\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    `}toggleAuditDetails(){const e=this.container.querySelector("#audit-details"),n=this.container.querySelector("#toggle-audit");e.classList.contains("hidden")?(e.classList.remove("hidden"),n.textContent="Hide Full Quantum Audit"):(e.classList.add("hidden"),n.textContent="Show Full Quantum Audit")}async copyResults(){const e=this.selectedNames.map((e,n)=>{const t=null!==e.number?` (#${e.number})`:"";return`${n+1}. ${e.name}${t}`}).join("\n");try{await navigator.clipboard.writeText(e),this.showCopyFeedback(this.container.querySelector("#copy-winners"))}catch(e){console.error("Copy failed:",e)}}async copyWinner(e){try{await navigator.clipboard.writeText(e);const n=this.container.querySelector(`[data-winner="${e}"]`);this.showCopyFeedback(n)}catch(e){console.error("Copy failed:",e)}}showCopyFeedback(e){const n=e.textContent;e.textContent="âœ…",e.style.background="#10b981",setTimeout(()=>{e.textContent=n,e.style.background=""},1500)}exportResults(){const e=(new Date).toISOString(),n=this.container.querySelector("#total-names-display").textContent,t=this.selectedNames.map((e,n)=>{const t=null!==e.number?` (Assigned: #${e.number})`:"";return`${n+1}. ${e.name}${t} [Original position: #${e.originalIndex}]`}).join("\n"),s=this.auditLog.map(e=>`Step ${e.step}: Quantum ${e.quantumValue} â†’ Swap [${e.swapIndices.join(",")}] â†’ Pool: ${e.remainingPool}`).join("\n"),i=`Quantum Name Selection Results\nGenerated: ${e}\nTotal Names: ${n}\nWinners Selected: ${this.selectedNames.length}\nSelection Method: Quantum Fisher-Yates Shuffle\n\nğŸ† WINNERS:\n${t}\n\nğŸ” QUANTUM AUDIT TRAIL:\n${s}\n\nğŸ“Š FAIRNESS VERIFICATION:\n- Method: Fisher-Yates shuffle with quantum entropy\n- Randomness Source: ANU Quantum Random Number Generator\n- Each name had equal probability of selection\n- All quantum values used are logged above for transparency\n\n---\nGenerated by Quantum Random Lab\nThis selection is cryptographically fair and verifiable.`,a=new Blob([i],{type:"text/plain"}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=`quantum-name-selection-${Date.now()}.txt`,o.click(),URL.revokeObjectURL(r)}showLoading(){this.container.querySelector("#name-loading").classList.remove("hidden"),this.container.querySelector("#name-error").classList.add("hidden"),this.container.querySelector("#name-success").classList.add("hidden"),this.container.querySelector("#select-winners").disabled=!0}showError(e){this.container.querySelector("#name-error-message").textContent=e,this.container.querySelector("#name-error").classList.remove("hidden"),this.container.querySelector("#name-loading").classList.add("hidden"),this.container.querySelector("#name-success").classList.add("hidden"),this.container.querySelector("#select-winners").disabled=!1}}window.QuantumNameTool=QuantumNameTool;